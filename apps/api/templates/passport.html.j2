<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Passport {{ run_id }}</title>
    <style>
      :root { --bg:#0b0d12; --card:#121624; --text:#e9edf6; --muted:#98a2b3; --bad:#ff4d4f; --ok:#45d483; --warn:#f7c948; --border:#232a3b; }
      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: radial-gradient(1200px 600px at 20% 10%, #162044 0%, transparent 55%), var(--bg); color:var(--text); }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 18px 60px; }
      .top { display:flex; gap:14px; align-items:baseline; flex-wrap:wrap; }
      h1 { font-size: 22px; margin:0; letter-spacing: .2px; }
      .meta { color: var(--muted); font-size: 13px; }
      .grid { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 12px; margin-top: 14px; }
      .card { background: rgba(18,22,36,.9); border:1px solid var(--border); border-radius: 14px; padding: 14px; }
      .k { color: var(--muted); font-size: 12px; }
      .v { font-size: 18px; margin-top: 6px; font-weight: 650; }
      .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; border:1px solid var(--border); background: rgba(255,255,255,.04); }
      .pill.ok { border-color: rgba(69,212,131,.35); color: var(--ok); }
      .pill.bad { border-color: rgba(255,77,79,.35); color: var(--bad); }
      .pill.warn { border-color: rgba(247,201,72,.35); color: var(--warn); }
      table { width:100%; border-collapse: collapse; margin-top: 10px; overflow:hidden; border-radius: 14px; border: 1px solid var(--border); }
      th, td { padding: 10px 10px; border-bottom: 1px solid var(--border); font-size: 13px; vertical-align: top; }
      th { text-align:left; color: var(--muted); font-weight: 600; background: rgba(255,255,255,.03); }
      tr:last-child td { border-bottom: none; }
      a { color: #9bd0ff; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .section { margin-top: 18px; }
      .two { display:grid; grid-template-columns: 1.2fr .8fr; gap: 12px; }
      .small { font-size: 12px; color: var(--muted); }
      @media (max-width: 860px) { .grid { grid-template-columns: repeat(2, minmax(0,1fr)); } .two { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="top">
        <h1>Vendor Red-Team Passport</h1>
        <span class="pill {{ 'ok' if passport.summary.release_gate=='PASS' else 'bad' }}">Gate: {{ passport.summary.release_gate }}</span>
        <span class="meta">run_id={{ run_id }} · model={{ meta.get('model','') }} · created={{ meta.get('created_at_utc','') }} · <a href="/runs/{{ run_id }}/claims">Claims vs Evidence</a></span>
      </div>

      <div class="grid">
        <div class="card"><div class="k">Overall</div><div class="v">{{ passport.summary.overall_score }}</div></div>
        <div class="card"><div class="k">P1 Pass</div><div class="v">{{ passport.summary.p1_pass_rate }}%</div></div>
        <div class="card"><div class="k">P2 Pass</div><div class="v">{{ passport.summary.p2_pass_rate }}%</div></div>
        <div class="card"><div class="k">Critical Failures (A4/A5/A6)</div><div class="v">{{ passport.summary.critical_failures }}</div></div>
        <div class="card"><div class="k">A9 Schema Validity</div><div class="v">{{ passport.summary.a9_schema_validity }}%</div></div>
        <div class="card"><div class="k">A9 Mode</div><div class="v">{{ passport.summary.a9_mode_used }}</div></div>
        <div class="card"><div class="k">A9 Strict Supported</div><div class="v">{{ passport.summary.a9_strict_supported }}</div></div>
        <div class="card"><div class="k">Suite</div><div class="v">{{ meta.get('suite_version','') }}</div></div>
      </div>

      <div class="two section">
        <div class="card">
          <div class="k">Class Scores</div>
          <table>
            <thead><tr><th>Class</th><th>Pass rate</th><th>Status</th></tr></thead>
            <tbody>
              {% for c in passport.class_scores %}
              <tr>
                <td>{{ c.attack_class }}</td>
                <td>{{ c.pass_rate }}%</td>
                <td>
                  <span class="pill {{ 'ok' if c.status=='PASS' else 'bad' }}">{{ c.status }}</span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <div class="small">Evidence files are stored under <code>reports/runs/{{ run_id }}/cases/</code>.</div>
        </div>

        <div class="card">
          <div class="k">Executive Verdict</div>
          <div class="v">{{ passport.executive_verdict.decision }}</div>
          <div class="section">
            <div class="k">Required remediations</div>
            <ul>
              {% for r in passport.executive_verdict.required_remediations %}
              <li>{{ r }}</li>
              {% endfor %}
            </ul>
          </div>
          <div class="section">
            <div class="k">Compliance mapping</div>
            <pre style="white-space:pre-wrap; font-size:12px; color:var(--muted); margin:8px 0 0;">{{ passport.executive_verdict.compliance_mapping | tojson(indent=2) }}</pre>
          </div>
        </div>
      </div>

      <div class="two section">
        <div class="card">
          <div class="k">Artifacts</div>
          <div style="height:8px;"></div>
          <div class="small"><a href="{{ artifacts.manifest }}">manifest.json</a> (sha256 + optional HMAC)</div>
          <div class="small"><a href="{{ artifacts.policy }}">policy.json</a> (gating thresholds)</div>
          <div class="small"><a href="{{ artifacts.coverage }}">coverage.json</a> (OWASP/NIST crosswalk)</div>
          <div class="small"><a href="{{ artifacts.compliance }}">compliance.json</a> (control mapping)</div>
          <div class="small" style="margin-top:10px;">Policy version: <code>{{ policy.version }}</code></div>
        </div>

        <div class="card">
          <div class="k">Coverage Summary (heuristic crosswalk)</div>
          <div style="height:8px;"></div>
          <div class="small">Executed classes: <code>{{ coverage.evaluated_classes | tojson }}</code></div>
          <div style="height:10px;"></div>
          <div class="k">OWASP LLM Top 10 IDs covered</div>
          <div class="small">
            {% if coverage.summary.owasp_llm_top10 %}
              {% for o in coverage.summary.owasp_llm_top10 %}
                <span class="pill">{{ o.id }}</span>
              {% endfor %}
            {% else %}
              <span class="small">None</span>
            {% endif %}
          </div>
          <div style="height:10px;"></div>
          <div class="k">NIST AI RMF functions covered</div>
          <div class="small">
            {% if coverage.summary.nist_ai_rmf %}
              {% for n in coverage.summary.nist_ai_rmf %}
                <span class="pill">{{ n.function }}</span>
              {% endfor %}
            {% else %}
              <span class="small">None</span>
            {% endif %}
          </div>
          <div class="small" style="margin-top:10px;">This is not certification; it is a communication aid.</div>
        </div>
      </div>

      <div class="card section">
        <div class="k">Top Blocking Findings (first 12 failures)</div>
        <table>
          <thead><tr><th>Case</th><th>Class</th><th>Expected</th><th>Actual</th><th>Latency</th><th>Evidence</th></tr></thead>
          <tbody>
            {% for f in passport.failed_cases[:12] %}
            <tr>
              <td>{{ f.case_id }}</td>
              <td>{{ f.attack_class }}</td>
              <td>{{ f.expected }}</td>
              <td><span class="pill bad">{{ f.actual }}</span></td>
              <td>{{ f.latency_ms if f.latency_ms is not none else '' }}</td>
              <td><a href="{{ evidence_link(f.case_id) }}">{{ evidence_link(f.case_id) }}</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="small">Note: outputs are sanitized before persistence.</div>
      </div>
    </div>
  </body>
</html>
